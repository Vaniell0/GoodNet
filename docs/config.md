# Менеджер конфигурации (Config)

Класс `Config` отвечает за управление настройками приложения. Он поддерживает загрузку и сохранение конфигурации в формате JSON, работу со значениями по умолчанию и типизированный доступ к данным.

## Основные возможности

* **JSON формат:** Человекочитаемый формат хранения настроек.
* **Иерархические ключи:** Доступ к вложенным объектам через точку (например, `core.listen_port`).
* **Типизация:** Поддержка типов `int`, `double`, `bool`, `std::string`.
* **Значения по умолчанию:** Автоматическая генерация конфигурации, если файл отсутствует.

## Структура конфигурации по умолчанию

При первом запуске (или отсутствии файла `config.json`) создается конфигурация со следующими секциями:

```json
{
  "core": {
    "listen_address": "0.0.0.0",
    "listen_port": 25565,
    "io_threads": 4,
    "max_connections": 1000
  },
  "logging": {
    "level": "INFO",
    "file": "logs/goodnet.log",
    "max_size": 10485760,
    "max_files": 5
  },
  "plugins": {
    "base_dir": "/path/to/plugins",
    "auto_load": true,
    "scan_interval": 300
  },
  "security": {
    "key_exchange_timeout": 30,
    "max_auth_attempts": 3,
    "session_timeout": 3600
  }
}

```

## Работа с конфигурацией в коде

### Инициализация

Конфиг загружается автоматически при создании экземпляра. Обычно используется как синглтон или передается по ссылке в основные сервисы.

```cpp
#include "config.hpp"

Config cfg;
// При создании cfg попытается загрузить 'config.json' из текущей директории.
// Если файла нет, он будет создан с настройками по умолчанию.

```

### Чтение значений

Для получения значений используйте методы `get` (возвращает `std::optional`) или `get_or` (возвращает значение по умолчанию, если ключ не найден).

**Рекомендуемый способ (`get_or`):**

```cpp
// Чтение целого числа
int port = cfg.get_or<int>("core.listen_port", 8080);

// Чтение строки
std::string host = cfg.get_or<std::string>("core.listen_address", "127.0.0.1");

// Чтение булевого значения
bool auto_load = cfg.get_or<bool>("plugins.auto_load", false);

```

**Строгий способ (`get`):**

```cpp
auto level = cfg.get<std::string>("logging.level");
if (level.has_value()) {
    std::cout << "Log level is: " << *level << std::endl;
} else {
    std::cerr << "Log level not set!" << std::endl;
}

```

### Изменение и сохранение

Вы можете изменять настройки программно и сохранять их обратно в файл.

```cpp
// Изменение значения
cfg.set("core.max_connections", 2000);

// Создание новой настройки (даже если её не было в JSON)
cfg.set("custom.my_setting", "some_value");

// Сохранение изменений на диск
if (cfg.save_to_file("config.json")) {
    // Успешно сохранено
}

```

## Интеграция с файловой системой

Класс поддерживает `std::filesystem::path` при установке значений, автоматически конвертируя их в строку для JSON.

```cpp
fs::path plugin_path = "/usr/local/lib/plugins";
cfg.set("plugins.base_dir", plugin_path);

```

## Обработка ошибок

* Если тип запрошенного значения не совпадает с фактическим (например, запросили `int`, а в конфиге `string`), `Logger` выведет ошибку `Config type mismatch`, а метод `get` вернет `std::nullopt`.
* При ошибках парсинга JSON подробности будут записаны в лог модуля `CONFIG`.